; PlatformIO Project Configuration File
; Fishtank Controller - ESP-IDF Framework
;
; Target Hardware:
;   - ESP32-C6 (Seeed XIAO ESP32-C6) - Primary
;   - ESP32-C5 - Future support
;
; Build: pio run -e seeed_xiao_esp32c6
; Upload: pio run -e seeed_xiao_esp32c6 -t upload
; Monitor: pio device monitor
; Upload + Monitor: pio run -e seeed_xiao_esp32c6 -t upload && pio device monitor

; =============================================================================
; Common Settings for all ESP-IDF environments
; =============================================================================
[platformio]
; Use main/ as source directory (standard ESP-IDF convention)
src_dir = main

[env]
platform = espressif32
framework = espidf
monitor_speed = 115200

; Use custom partition table with OTA support
board_build.partitions = partitions.csv

; LittleFS for web UI assets
board_build.filesystem = littlefs

; Additional CMake defines
build_flags =
    -DLOG_LOCAL_LEVEL=ESP_LOG_INFO

; =============================================================================
; ESP32-C6 Target (Primary - Seeed XIAO ESP32-C6)
; =============================================================================
[env:seeed_xiao_esp32c6]
board = seeed_xiao_esp32c6

; Board-specific sdkconfig
board_build.cmake_extra_args =
    -DSDKCONFIG_DEFAULTS=sdkconfig.defaults

; =============================================================================
; ESP32-C5 Target (Future)
; =============================================================================
; [env:esp32c5]
; board = esp32c5
; board_build.cmake_extra_args =
;     -DSDKCONFIG_DEFAULTS=sdkconfig.defaults

; =============================================================================
; Native Test Environment (runs on host computer)
; =============================================================================
[env:native]
platform = native
; Override inherited espidf settings - native has no framework
framework =
board_build.partitions =
board_build.filesystem =
build_flags =
    -I components/derived_metrics/include
    -I components/calibration/include
    -I components/warning_manager/include
    -I components/data_history/include
    -DUNIT_TEST
    -std=gnu11
    -lm
build_src_filter =
    +<../components/derived_metrics/derived_metrics.c>
test_framework = unity
test_build_src = yes
; Only run test_native tests, ignore old Arduino tests
test_filter = test_native
; Ignore all libraries in lib/ (old Arduino libs)
lib_ignore =
    DerivedMetrics
    WiFiManager
    WebServer
    CalibrationManager
    MQTTManager
    TankSettingsManager
    WarningManager
    DisplayManager
lib_deps =
    throwtheswitch/Unity@^2.6.0

; =============================================================================
; Embedded Test Environment (runs on ESP32-C6)
; =============================================================================
[env:esp32c6_test]
board = seeed_xiao_esp32c6
test_framework = unity
test_filter = test_embedded
; Ignore old Arduino libs
lib_ignore =
    DerivedMetrics
    WiFiManager
    WebServer
    CalibrationManager
    MQTTManager
    TankSettingsManager
    WarningManager
    DisplayManager

; =============================================================================
; Legacy Arduino Configuration (for reference)
; =============================================================================
; [env:seeed_xiao_esp32c3_arduino]
; platform = espressif32
; board = seeed_xiao_esp32c3
; framework = arduino
; monitor_speed = 115200
; build_flags =
;     -DCORE_DEBUG_LEVEL=0
; lib_deps =
;     https://github.com/me-no-dev/ESPAsyncWebServer.git
;     https://github.com/me-no-dev/AsyncTCP.git
;     bblanchon/ArduinoJson@^7.0.0
;     knolleary/PubSubClient@^2.8
;     adafruit/Adafruit SSD1306@^2.5.7
;     adafruit/Adafruit GFX Library@^1.11.9
